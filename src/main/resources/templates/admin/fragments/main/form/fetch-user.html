<!-- th:if="${user != null}" -->
<!-- style="display: contents;" -->
<div th:fragment="fetch-user(user)" class="fetch-user">
  <!-- <input type="hidden" th:value="${userId}" id="hidden-user-id" /> -->

  <p>
    For :
    <span
      th:text="${user != null ? user.firstName + ' ' + user.lastName : 'Firstname Lastname'}"
    ></span>
  </p>
  <p>
    Email :
    <span
      th:text="${userProjection != null ? userProjection.email : 'example@email.com'}"
    ></span>
  </p>

  <form action="/admin/updateUser" method="POST" id="update-user" data-spa-form>
    <fieldset>
      <legend th:text="${user != null ? user.role : 'USER'}"></legend>
      <input
        type="hidden"
        name="userId"
        th:value="${user != null ? user.id : ''}"
      />
      <label
        for="password"
        data-invalid="Invalid Password"
        data-empty="Input a Password"
        data-valid="Password is Valid"
      >
        Enter New Password :
        <input
          type="password"
          id="password"
          aria-describedby="password-help"
          placeholder="password"
          pattern="^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$"
          name="password"
          autocomplete="new-password"
        />
      </label>
      <label
        for="password2"
        data-invalid="Invalid Password"
        data-empty="Input a Password"
        data-valid="Password is Valid"
      >
        Enter The New Password Again :
        <input
          type="password"
          id="password2"
          aria-describedby="password-help"
          placeholder="password"
          pattern="^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$"
          name="password2"
          autocomplete="new-password"
        />
      </label>
      <div class="show-password">
        <input type="checkbox" aria-checked="false" id="show-password" />
        <label for="show-password">Show Password</label>
      </div>
      <label for="payment">User Payment : </label>
      <input
        id="payment"
        type="number"
        th:value="${userProjection != null && userProjection.getPayment() != null ? userProjection.getPayment().getAmount() : ''}"
        name="payment"
      />
      <label for="payment-date">Payment Date : </label>
      <input
        type="date"
        th:value="${userProjection != null ? nextDate : ''}"
        name="nextDate"
        id="payment-date"
      />
      <!-- <label
        for="department"
        th:if="${user != null && user.roles[0].roleNameString == 'TEACHER'}"
        >Department :
      </label>
      <input
        type="text"
        th:if="${userProjection != null && user != null && user.roles[0].roleNameString == 'TEACHER'}"
        th:value="${userProjection.department}"
        id="department"
      /> -->
      <label for="affiliation-date">Affiliation Date : </label>
      <input
        type="date"
        th:value="${userProjection != null ? userProjection.affiliationDate : ''}"
        id="affiliation-date"
      />
    </fieldset>
    <button type="submit">Submit</button>
  </form>

  <!-- data-spa-form -->
  <div class="forms">
    <form
      th:action="@{/admin/banUnbanUser/{id}(id=${userProjection.id})}"
      method="post"
      th:if="${user != null}"
      data-spa-form
    >
      <input
        type="hidden"
        th:name="${_csrf.parameterName}"
        th:value="${_csrf.token}"
      />
      <input type="hidden" name="spa" th:value="${spa}" />
      <input type="hidden" th:value="${userProjection.role}" name="role" />
      <button
        type="submit"
        th:text="${user.isBanned ? 'unBan' : 'ban'}"
        th:class="${user.isBanned ? 'unBan fetch' : 'ban fetch'}"
      ></button>
    </form>

    <!-- onclick="showDialog(true)" -->
    <button
      class="deleteUser"
      type="button"
      th:if="${user != null}"
      dialog="deleteUser"
    >
      Delete User
    </button>
  </div>

  <div th:if="${user != null && userProjection.role == 'TEACHER'}">
    <!-- onclick="showDialog(true)" -->
    <button
      class="createCourseOffering"
      type="button"
      th:if="${user != null}"
      dialog="courseOffering"
    >
      Create Course Offering
    </button>
    <button
      class="createCourseOffering"
      type="button"
      th:if="${user != null}"
      dialog="courseOfferingsView"
    >
      View Course Offerings
    </button>
  </div>

  <dialog
    th:if="${user != null && userProjection.role == 'TEACHER'}"
    courseOffering
  >
    <div class="wrapper">
      <h2>Add a Subject and Students for the Teacher's Course Offerings</h2>
      <form
        action="/admin/createCourseOffering"
        method="POST"
        class="courseOfferingForm"
      >
        <input
          type="hidden"
          th:name="${_csrf.parameterName}"
          th:value="${_csrf.token}"
        />

        <input type="hidden" name="teacherId" th:value="${userId}" />

        <select name="subjectId" id="subject">
          <option
            th:each="subject : ${allSubjects}"
            th:value="${subject.id}"
            th:text="${subject.subjectTitle}"
          >
            Subject Title
          </option>
        </select>

        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th class="description">Full name</th>
              <th>Email</th>
              <th>EnrolledAt</th>
            </tr>
          </thead>

          <tbody
            th:replace="~{admin/fragments/tables/entity-pagination.html :: courseOfferingTableBody(${studentsOnPage})}"
          ></tbody>
        </table>
        <div id="pagination-container">
          <nav
            th:replace="~{admin/fragments/tables/entity-pagination.html :: courseOfferingPagination('/admin/fetchUser', ${studentsOnPage}, ${pagesForStudents}, 'pageIndex')}"
          ></nav>
        </div>
        <button type="submit">Submit</button>
      </form>
      <p id="selectedCount"></p>
      <button class="close-button" clsBttn>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          height="24px"
          viewBox="0 -960 960 960"
          width="24px"
          fill="#e8eaed"
        >
          <path
            d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"
          />
        </svg>
      </button>
    </div>
  </dialog>

  <dialog
    th:if="${user != null && userProjection.role == 'TEACHER'}"
    courseOfferingsView
  >
    <div class="wrapper">
      <!-- <div class="title">
        <h3>Course Offerings of : <span th:text="${user.firstName + ' ' + user.lastName}"></span></h3>
      </div> -->
      <div class="activity">
        <div class="panel">
          <table>
            <caption>
              Course Offerings of :
              <span th:text="${user.firstName + ' ' + user.lastName}"></span>
            </caption>
            <thead>
              <tr>
                <th>ID</th>
                <th>Subject</th>
                <th>Student Count</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr th:if="${courseOfferings.size() == 0}">
                <td>No Course Offerings yet...</td>
              </tr>
              <tr th:each="courseOffering : ${courseOfferings}">
                <td th:text="${courseOffering.id}"></td>
                <td th:text="${courseOffering.subject.subjectTitle}"></td>
                <td th:text="${courseOffering.courseEnrollments.size()}"></td>
                <td>
                  <a
                    data-spa
                    th:href="@{'/admin/courseOfferings/' + ${courseOffering.id}}"
                    >More Details...</a
                  >
                </td>
                <td>
                  <form
                    th:action="@{'/admin/deleteCourseOffering/' + ${courseOffering.id}}"
                    method="POST"
                    data-spa-form
                  >
                    <input
                      type="hidden"
                      th:name="${_csrf.parameterName}"
                      th:value="${_csrf.token}"
                    />
                    <input type="hidden" th:value="${spa}" name="spa" />
                    <input type="hidden" th:value="${userId}" name="userId" />
                    <button
                      type="submit"
                      class="delete-user"
                      style="background-color: transparent; border: none"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        height="24px"
                        viewBox="0 -960 960 960"
                        width="24px"
                        fill="#e3e3e3"
                      >
                        <path
                          d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"
                        />
                      </svg>
                    </button>
                  </form>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <button class="close-button" clsBttn>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          height="24px"
          viewBox="0 -960 960 960"
          width="24px"
          fill="#e8eaed"
        >
          <path
            d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"
          />
        </svg>
      </button>
    </div>
  </dialog>

  <dialog deleteUser>
    <div class="wrapper">
      <h2>Are You Sure You Want To Delete The User?</h2>
      <form
        th:action="@{/admin/deleteUser/{id}(id=${user.id})}"
        method="post"
        data-spa-form
        th:if="${user != null}"
      >
        <input
          type="hidden"
          th:name="${_csrf.parameterName}"
          th:value="${_csrf.token}"
        />
        <input type="hidden" th:value=" ${spa}" name="spa" />

        <div class="opts-dialog">
          <button type="submit" class="deleteUser">Delete User</button>
          <button type="button" class="cancel" clsBttn>Cancel</button>
        </div>
      </form>
      <button class="close-button" clsBttn>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          height="24px"
          viewBox="0 -960 960 960"
          width="24px"
          fill="#e8eaed"
        >
          <path
            d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"
          />
        </svg>
      </button>
    </div>
  </dialog>
</div>
